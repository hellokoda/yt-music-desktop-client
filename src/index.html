<!DOCTYPE html>
<html>
    <head>
        <title>Connecting... - YouTube Music</title>
        <link type="text/css" rel="stylesheet" href="css/main.css" />
        <!-- <meta http-equiv="refresh" content="0; url=https://music.youtube.com/" /> -->
        <link type="text/css" rel="stylesheet" href="../css/materialize.min.css"  media="screen,projection"/>
    </head>
    <body>
        <div class="flex-box">
            <div class="center">
                <div class="content-wrapper fadeOut">
                    <div>
                        <img src="all_platform_logo_dark.svg" width="400" />
                    </div>
                    <br>
                    <div class="preloader-wrapper small active">
                        <div class="spinner-layer spinner-blue-only">
                            <div class="circle-clipper left">
                            <div class="circle"></div>
                            </div><div class="gap-patch">
                            <div class="circle"></div>
                            </div><div class="circle-clipper right">
                            <div class="circle"></div>
                            </div>
                        </div>
                    </div>
                    <h4></h4>
                    <p></p>    
                </div>
            </div>
        </div>
        <script type="text/javascript" src="../js/materialize.min.js"></script>
        <script type="text/javascript" src="../js/jquery.js"></script>
        <script>
            window.onload = function(){
                $(".content-wrapper")[0].classList.remove("fadeOut")
            }
            function appOpen() {
                if($(".content-wrapper")[0].classList.contains("show-message")) {
                    $(".content-wrapper")[0].classList.remove("show-message");
                }
                $("h4").html("");
                $("p").html("");
                $(".content-wrapper")[0].classList.add("fadeOut")
                setInterval(() => {window.location = "https://music.youtube.com/";}, 1000);
            }
            function checkConnection(i, s) {
                $.getJSON("https://koda.life/ping.php?i="+i, data => {
                    console.log(data.integ)
                    console.log(i)
                    if(data.message == "pong" && data.integ == i) {
                        appOpen();
                    }
                    else {
                        if(s == true) {
                            $(".content-wrapper")[0].classList.add("show-message");
                            $("h4").html("Connecting...");
                            $("p").html(`This is taking longer than expected.<br>Please ensure you have a working internet connection.<br><br><a class="waves-effect waves-light btn btn-primary" href="javascript:appOpen()">open anyway</a>`);
                        }
                    }
                }).catch(ex => {
                    if(s == true) {
                        $(".content-wrapper")[0].classList.add("show-message");
                        $("h4").html("Connecting...");
                        $("p").html(`This is taking longer than expected.<br>Please ensure you have a working internet connection.<br><br><a class="waves-effect waves-light btn btn-primary" href="javascript:appOpen()">open anyway</a>`);
                    }
                })
            }
            setInterval(() => {
                checkConnection(Math.floor(Math.random() * 120309992), true);
            }, 7500)
            setTimeout(() => {
                checkConnection(Math.floor(Math.random() * 120309992), false);                
            }, 2000);
        </script>
    </body>
</html>
